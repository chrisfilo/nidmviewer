<html>
<!-- Nidm Viewer, for Server
     @vsoch, Poldracklab <3
-->
<head>
    <title>NIDM Viewer</title>
    <script src="https://rawgithub.com/vsoch/nidmviewer/master/js/jquery-2.1.4.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://rawgithub.com/vsoch/nidmviewer/master/css/bootstrap.min.css">
    <script src="https://rawgithub.com/vsoch/nidmviewer/master/js/bootstrap.min.js"></script>
    <script src="https://rawgithub.com/vsoch/nidmviewer/master/js/d3.min.js"></script>
    <script src="https://rawgithub.com/vsoch/nidmviewer/master/js/script.js"></script>
    <script src="https://rawgithub.com/vsoch/nidmviewer/master/js/table.js"></script>
    <script src="https://rawgithub.com/vsoch/nidmviewer/master/js/scribl.min.js"></script>
    <script src="https://rawgithub.com/vsoch/nidmviewer/master/js/bootstrap-table.js"></script>
    <link href="https://rawgithub.com/vsoch/nidmviewer/master/css/fresh-bootstrap-table.css" rel="stylesheet" />
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://rawgithub.com/vsoch/font-brain/master/font-brain/font-brain.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://rawgithub.com/vsoch/nidmviewer/master/css/papaya.css" /> <!--version=0.8&build=910-->
    <script type="text/javascript" src="https://rawgithub.com/vsoch/nidmviewer/master/js/papaya.js"></script> <!--version=0.8&build=910,beta-->
</head>

<body>

    <div class="row">

            <!-- Buttons! -->
            <div id="button_zone">

                <div class="float-left-wrapper">

                    <!-- NIDM Selection -->
                    <button class="btn btn-default">
                        <li class="dropdown">
                            <a data-toggle="dropdown" class="dropdown-toggle" href="#">Dropdown <b class="caret"></b></a>
                                <ul class="dropdown-menu" id="nidm_selection">
                                </ul>
                        </li>
                    </button>
                </div>

                <div class="float-right-wrapper">

                    <!-- View image buttons will be appended here -->
                    <span id="nidm_images">
                    </span>

                    <a href="http://www.github.com/vsoch/nidmviewer" target="_blank">
                        <button class="btn btn-default circle"><i class="fa fa-github"></i></button>
                    </a>
            </div>
        </div>


<div class="row">

    <!-- Left sidebar region for tables -->
    <div id="bluetable" class="col-md-6">

        <!-- Tables for nidm will be dynamically rendered here -->
        <div class="row" id="tablerow">
        </div>
    </div>

    <!-- Papaya viewer window -->
    <div id="pappy" class="col-md-6">

    <script type="text/javascript" src="https://rawgithub.com/vsoch/nidmviewer/master/js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="https://rawgithub.com/vsoch/nidmviewer/master/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://rawgithub.com/vsoch/nidmviewer/master/js/bootstrap-table.js"></script>
    <script type="text/javascript">

     var brain_images = {'/home/vanessa/Documents/Dropbox/Code/nifti-drop/nidm-viewer/examples/fsl/nidm.ttl': {'TStatistic_T002.nii.gz': 'fsl/TStatistic_T002.nii.gz', 'ExcursionSet_T002.nii.gz': 'fsl/ExcursionSet_T002.nii.gz', 'ZStatistic_T002.nii.gz': 'fsl/ZStatistic_T002.nii.gz', 'cope1.nii.gz': 'fsl/Contrast_T001.nii.gz', 'ContrastStandardError_T002.nii.gz': 'fsl/ContrastStandardError_T002.nii.gz', 'thresh_zstat1.nii.gz': 'fsl/ExcursionSet_T001.nii.gz', 'cope2.nii.gz': 'fsl/Contrast_T002.nii.gz', 'mean_func.nii.gz': 'fsl/GrandMean.nii.gz', 'Mask.nii.gz': 'fsl/Mask.nii.gz', 'zstat1.nii.gz': 'fsl/ZStatistic_T001.nii.gz', 'tstat1.nii.gz': 'fsl/TStatistic_T001.nii.gz', 'ContrastStandardError_T001.nii.gz': 'fsl/ContrastStandardError_T001.nii.gz', 'SearchSpaceMask.nii.gz': 'fsl/SearchSpaceMask.nii.gz', 'sigmasquareds.nii.gz': 'fsl/ResidualMeanSquares.nii.gz'}};
     var peaks = {'/home/vanessa/Documents/Dropbox/Code/nifti-drop/nidm-viewer/examples/fsl/nidm.ttl': [{'pvalue_uncorrected': '4.99600361081e-15', 'equivalent_zstatistic': '7.74', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '-23.6', 'x': '-65.0', 'z': '-0.366'}, {'pvalue_uncorrected': '1.92488691653e-10', 'equivalent_zstatistic': '6.26', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '-92.6', 'x': '4.83', 'z': '-5.96'}, {'pvalue_uncorrected': '0.00180714378081', 'equivalent_zstatistic': '2.91', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '23.6', 'x': '11.7', 'z': '-10.2'}, {'pvalue_uncorrected': '3.07593950311e-11', 'equivalent_zstatistic': '6.54', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '0.362', 'x': '-55.5', 'z': '-8.19'}, {'pvalue_uncorrected': '9.73121583314e-12', 'equivalent_zstatistic': '6.71', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '-31.7', 'x': '-51.9', 'z': '6.5'}, {'pvalue_uncorrected': '8.85440609721e-11', 'equivalent_zstatistic': '6.38', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '-80.4', 'x': '-3.77', 'z': '-13.0'}, {'pvalue_uncorrected': '6.00874905388e-12', 'equivalent_zstatistic': '6.78', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '-13.0', 'x': '55.4', 'z': '-2.87'}, {'pvalue_uncorrected': '4.87987428244e-12', 'equivalent_zstatistic': '6.81', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '-92.1', 'x': '-30.9', 'z': '8.27'}, {'pvalue_uncorrected': '0.000301790624609', 'equivalent_zstatistic': '3.43', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '31.5', 'x': '20.9', 'z': '-17.5'}, {'pvalue_uncorrected': '2.08388861722e-13', 'equivalent_zstatistic': '7.25', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '-92.4', 'x': '-8.52', 'z': '-5.73'}, {'pvalue_uncorrected': '1.04209973983e-11', 'equivalent_zstatistic': '6.7', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '3.06', 'x': '55.9', 'z': '-17.1'}, {'pvalue_uncorrected': '0.000967603213218', 'equivalent_zstatistic': '3.1', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '31.7', 'x': '3.07', 'z': '-17.1'}, {'pvalue_uncorrected': '4.07408045586e-05', 'equivalent_zstatistic': '3.94', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '39.5', 'x': '25.5', 'z': '-17.8'}, {'pvalue_uncorrected': '0.000270087693963', 'equivalent_zstatistic': '3.46', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '55.4', 'x': '39.2', 'z': '-18.6'}, {'pvalue_uncorrected': '1.37445610449e-12', 'equivalent_zstatistic': '6.99', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '-96.4', 'x': '-8.72', 'z': '8.03'}, {'pvalue_uncorrected': '2.87685431033e-11', 'equivalent_zstatistic': '6.55', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '-7.65', 'x': '-55.7', 'z': '-1.09'}, {'pvalue_uncorrected': '8.48321413116e-12', 'equivalent_zstatistic': '6.73', 'pvalue_fwer': 'nan', 'statistic_type': 'nan', 'y': '-96.7', 'x': '13.5', 'z': '7.64'}]};
     var column_names = {'/home/vanessa/Documents/Dropbox/Code/nifti-drop/nidm-viewer/examples/fsl/nidm.ttl': ['pvalue_uncorrected', 'equivalent_zstatistic', 'pvalue_fwer', 'statistic_type', 'x', 'y', 'z']};


     var cx;
     var params = [];
     params["worldSpace"] = true;
     params["expandable"] = false;
     params["combineParametric"] = true;
     params["showControls"] = false;
     params["luts"] = [{"name":"PuBu", "data":[[0,1,0.968627,0.984314],[0.125,0.92549,0.905882,0.94902],[0.25,0.815686,0.819608,0.901961],[0.375,0.65098,0.741176,0.858824],[0.5,0.454902,0.662745,0.811765],[0.625,0.211765,0.564706,0.752941],[0.75,0.0196078,0.439216,0.690196],[0.875,0.0156863,0.352941,0.552941],[1,0.00784314,0.219608,0.345098]]},
     {"name":"OrRd", "data":[[0,1,0.968627,0.92549],[0.125,0.996078,0.909804,0.784314],[0.25,0.992157,0.831373,0.619608],[0.375,0.992157,0.733333,0.517647],[0.5,0.988235,0.552941,0.34902],[0.625,0.937255,0.396078,0.282353],[0.75,0.843137,0.188235,0.121569],[0.875,0.701961,0,0],[1,0.498039,0,0]]}];
     params["fsl/MNI152_T1_2mm_brain.nii.gz"] = {"parametric": true,  "min":0, "alpha":"0.75", "symmetric":true};
     params["kioskMode"] = true;    


// Function to add / remove image from viewer
function viewimage(file) {

     // Tag canvas, and show export button
     $($("canvas")[0]).attr("id","papaya-canvas")
     $("#export").show()

     // Reset viewer and load new images
     papayaContainers[0].viewer.resetViewer(0,params);
     papayaContainers[0].toolbar.updateImageButtons();
     papayaContainers[0].viewer.loadBaseImage(["fsl/MNI152_T1_2mm_brain.nii.gz"],true)
     params[file] = {"parametric": true,  "min":0, "lut":"OrRd", "negative_lut":"PuBu", "alpha":"0.75", "symmetric":true};
     setTimeout(function(){
             papayaContainers[0].viewer.loadOverlay([file],true);
     }, 500);
       
}

</script>

	<div class="papaya" data-params="params"></div>

        <!-- View svg modal -->
        <div class="modal" id="exportmodal">
            <div class="modal-admin">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">x</span></button>
                        <h4 class="modal-title">Right click to Save As</h4>
                    </div>
                    <div class="modal-body">
                        <div id="svgexport"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->


	
        </div>
    </div>     
</div>


    <script type="text/javascript">        
            
        $().ready(function(){

	     // Generate initial table, and buttons for nidm
	     nidm_files = []
	     for (var nidm in peaks) {
		 if (peaks.hasOwnProperty(nidm)) {
		     nidm_files.push(nidm)
                     console.log(nidm);
                     $("#nidm_selection").append("<li><a href='#' onclick=view_nidm(\""+ nidm +"\")>" + nidm + "</a></li>")
		 }
	     }

	     // Generate a table with the first nidm file     
	     nidm_table(peaks[nidm_files[0]],column_names[nidm_files[0]])

             // Load first brain image into the viewer
             load_images(brain_images[nidm_files[0]])
             $('.dropdown-toggle').dropdown()

         });

        function operateFormatter(value, row, index) {
            return [
                //'<a rel="tooltip" title="Like" class="table-action like" href="javascript:void(0)" title="Like">',
                //    '<i class="fa fa-heart"></i>',
                //'</a>',
                //'<a rel="tooltip" title="Edit" class="table-action edit" href="javascript:void(0)" title="Edit">',
                //    '<i class="fa fa-edit"></i>',
                //'</a>',
                '<a rel="tooltip" title="Remove" class="table-action remove" href="javascript:void(0)" title="Remove">',
                    '<i class="fa fa-remove"></i>',
                '</a>'
            ].join('');
        }
       
    </script>

<script>
$(function () {
    $(".search").css("width","160px")
    $('button[name=toggle]').css("height","40px")
    $("#export").hide()
    $("#export").css("margin-left",30)
});
</script>
<link href="http://fonts.googleapis.com/css?family=Roboto:300" rel="stylesheet" type="text/css">
<link href="https://rawgithub.com/vsoch/nidmviewer/master/css/style.css" rel="stylesheet" type="text/css">
</body></html>
